<!DOCTYPE html><html lang="ko"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 이펙티브자바 3장. 모든 객체의 공통 메서드 - 1 · Wicksome Blog</title><meta name="description" content="chapter 3. Methods Common To All Objects in effective java"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="canonical" href="https://wickso.me/2017/03/11/methods-common-to-all-objects-1/"><link rel="search" type="application/opensearchdescription+xml" href="https://wickso.me/atom.xml" title="Wicksome Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/categories/slide/" target="_self" class="nav-list-link">SLIDE</a></li><li class="nav-list-item"><a href="https://github.com/wicksome" target="_blank" class="nav-list-link" rel="external nofollow noopener noreferrer">GITHUB</a></li><li class="nav-list-item"><a href="https://www.linkedin.com/in/yeongjun/" target="_blank" class="nav-list-link" rel="external nofollow noopener noreferrer">RESUME</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">이펙티브자바 3장. 모든 객체의 공통 메서드 - 1</h1><div class="post-info">2017년 3월 11일<ul class="tags"><li><a href="/tags/java/" title="java" class="tag">java </a></li><li><a href="/tags/effective-java/" title="effective java" class="tag">effective java </a></li></ul></div><div class="post-content"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><a href="../../../../2017/03/11/methods-common-to-all-objects-1/#규칙-8-equals를-재정의할-때는-일반-규약을-따르라">규칙 8</a> - equals를 재정의할 때는 일반 규약을 따르라<br><a href="../../../../2017/03/11/methods-common-to-all-objects-1/#규칙-9-equals-메서드를-재정의하는-클래스는-반드시-hashCode-메서드도-재정의-해야-한다">규칙 9</a> - equals 메서드를 재정의하는 클래스는 반드시 hashCode 메서드도 재정의 해야 한다<br><a href="../../../../2017/03/11/methods-common-to-all-objects-1/#규칙-10-toString은-항상-재정의하라">규칙 10</a> - toString은 항상 재정의하라</p>
<a id="more"></a>
<div class="tip"><br>    <div>아래 책를 참고하여 학습한 내용을 정리/기록한 포스트입니다. 자세한 내용은 책을 참고하시기 바라며, 문제가 있을 경우 연락 부탁드립니다.</div><br>    <ul><br>        <li>조슈아 블로크, 이병준(옮긴이), Effective Java, 2판, 인사이트, 2015.</li><br>    </ul><br></div>

<hr>
<h2 id="규칙-8-equals를-재정의할-때는-일반-규약을-따르라"><a href="#규칙-8-equals를-재정의할-때는-일반-규약을-따르라" class="headerlink" title="규칙 8. equals를 재정의할 때는 일반 규약을 따르라"></a>규칙 8. equals를 재정의할 때는 일반 규약을 따르라</h2><h4 id="override-상황"><a href="#Override-상황" class="headerlink" title="Override 상황"></a>Override 상황</h4><h6 id="override-하지-않는-경우"><a href="#Override-하지-않는-경우" class="headerlink" title="Override 하지 않는 경우"></a>Override 하지 않는 경우</h6><ol>
<li>각각의 객체가 고유할 때<br> 값<sub>value</sub> 대신 활성 개체<sub>active entity</sub>를 나타내는 <em>Thread</em> 같은 클래스.</li>
<li>논리적 동일성<sub>logical equality</sub> 검사 방법이 상관 없을 때<br> <em>Random</em> 클래스를 설계할 때 값 비교를 사용안할 것 같아서 구현하지 않는 것처럼 필요 없을 경우</li>
<li>상위 클래스에서 정의한 equals가 하위 클래스에서 사용 가능할 때</li>
<li><p>클래스가 private, package-private로 선언되었고, equals를 호출할 일이 없을 때</p>
<blockquote>
<p>필자는 이런 상황에서는 반드시 equals를 재정의해야 한다고 본다. 실수로 equals를 호출할 수도 있기 때문.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> Boolean <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</div><div class="line"><span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(); <span class="comment">// 호출되면 안 되는 메서드를 호출했다는 뜻</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<h6 id="override-하는-경우"><a href="#Override-하는-경우" class="headerlink" title="Override 하는 경우"></a>Override 하는 경우</h6><ol>
<li><em>논리적 동일성<sub>logical equality</sub></em>의 개념을 지원하는 클래스일 때</li>
<li>상위 클래스의 equals가 하위 클래스의 필요를 충족하지 못할 때</li>
</ol>
<h6 id="override-할-필요가-없는-경우"><a href="#Override-할-필요가-없는-경우" class="headerlink" title="Override 할 필요가 없는 경우"></a>Override 할 필요가 없는 경우</h6><ol>
<li>개체 통제(<a href="#item1">규칙 1</a>) 기능으로 하나의 객체만 존재하는 클래스(e.g. 싱글톤, enum(<a href="#item30">규칙 30</a>))</li>
</ol>
<h4 id="override-규약-주의"><a href="#Override-규약-주의" class="headerlink" title="Override 규약, 주의"></a>Override 규약, 주의</h4><h6 id="equals-메서드를-정의할-때-준수해야-하는-일반-규약general-contract"><a href="#equals-메서드를-정의할-때-준수해야-하는-일반-규약general-contract" class="headerlink" title="equals 메서드를 정의할 때 준수해야 하는 일반 규약general contract"></a>equals 메서드를 정의할 때 준수해야 하는 일반 규약<sub>general contract</sub></h6><blockquote>
<p><em>Object</em> 클래스 명세(specification)[JavaSE6]</p>
</blockquote>
<p><em>동치 관계<sub>equivalence relation</sub></em> 구현, 다음과 같은 관계를 동치 관계라 한다.</p>
<ul>
<li><strong>반사성<sub>Reflexivity</sub></strong>: <code>x.equals(x)</code>는 <code>true</code></li>
<li><p><strong>대칭성<sub>Symmetry</sub></strong>: <code>x.equals(y)</code>가 <code>true</code>일 때, <code>y.equals(x)</code>도 <code>true</code></p>
<p>  <em>e.g. 대칭성 위반 코드</em></p>
  <figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomString</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String str;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (o <span class="keyword">instanceof</span> CustomString) &#123;</div><div class="line">      <span class="keyword">return</span> str.equalsIgnoreCase(((CustomString) o).getStr());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (o <span class="keyword">instanceof</span> String) &#123; <span class="comment">// 대칭성 위반</span></div><div class="line">      <span class="keyword">return</span> str.equalsIgnoreCase((String) o);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
  <figure class="highlight java"><table><tr><td class="code"><pre><div class="line">CustomString cs = <span class="keyword">new</span> CustomString(<span class="string">"string"</span>);</div><div class="line">String s = <span class="string">"string"</span>;</div><div class="line"></div><div class="line">cs.equals(s); <span class="comment">// true</span></div><div class="line">s.equals(cs); <span class="comment">// false</span></div><div class="line"></div><div class="line">List&lt;CustomString&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">...</div><div class="line"><span class="comment">// JVM에 따라 결과가 달라진다.</span></div><div class="line">list.contains(s);</div></pre></td></tr></table></figure>
<blockquote>
<p>equals가 따라야 할 규약을 어기면, 그 객체를 만난 다른 객체들이 어떻게 행동할지 예측할 수 없게 된다.</p>
</blockquote>
</li>
<li><p><strong>추이성<sub>Transitivity</sub></strong>: <code>x.equals(y)</code>가 <code>true</code>이고, <code>y.equals(z)</code>가 <code>true</code>이면 <code>x.equals(z)</code>도 <code>true</code></p>
<p>  <em>e.g. 하위 클래스에서 새로운 값 컴포넌트<sub>value component</sub>를 추가하는 상황.</em></p>
<p>  <em>ColorPoint 클래스</em>(하위 클래스)의 <code>equals()</code>에서 새로운 값 color를 비교하는 로직을 추가할 경우, 대칭성에 위반</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="meta">@AllArgsConstructor</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> x, y;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (!(obj <span class="keyword">instanceof</span> Point)) &#123; <span class="keyword">return</span> <span class="keyword">false</span>; &#125;</div><div class="line">    Point p = (Point)obj;</div><div class="line">    <span class="keyword">return</span> p.x == x &amp;&amp; p.y == y;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ColorPoint</span> <span class="keyword">extends</span> <span class="title">Point</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Color color;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ColorPoint</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, Color color)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>(x, y);</div><div class="line">    <span class="keyword">this</span>.color = color;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 대칭성 위반</span></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (!(obj <span class="keyword">instanceof</span> ColorPoint)) &#123; <span class="keyword">return</span> <span class="keyword">false</span>; &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.equals(obj) &amp;&amp; ((ColorPoint)obj).color == color;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
  <figure class="highlight java"><table><tr><td class="code"><pre><div class="line">Point p1 = <span class="keyword">new</span> Point(<span class="number">1</span>, <span class="number">2</span>);</div><div class="line">Point p2 = <span class="keyword">new</span> ColorPoint(<span class="number">1</span>, <span class="number">2</span>, Color.BLUE);</div><div class="line">p1.equals(p2); <span class="comment">// true</span></div><div class="line">p2.equals(p1); <span class="comment">// false</span></div></pre></td></tr></table></figure>
<p>  그래서 Point 객체일 때 color 값을 비교안하도록 할 경우, 대칭성은 보존되지만 추이성 위반</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ColorPoint</span> <span class="keyword">extends</span> <span class="title">Point</span> </span>&#123;</div><div class="line">  ...</div><div class="line"></div><div class="line">  <span class="comment">// 추이성 위반</span></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (!(obj <span class="keyword">instanceof</span> Point)) <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    <span class="keyword">if</span> (!(obj <span class="keyword">instanceof</span> ColorPoint)) <span class="keyword">return</span> obj.equals(<span class="keyword">this</span>);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.equals(obj) &amp;&amp; ((ColorPoint)obj).color == color;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
  <figure class="highlight java"><table><tr><td class="code"><pre><div class="line">Point p0 = <span class="keyword">new</span> ColorPoint(<span class="number">1</span>, <span class="number">2</span>, Color.RED);</div><div class="line">Point p1 = <span class="keyword">new</span> Point(<span class="number">1</span>, <span class="number">2</span>);</div><div class="line">Point p2 = <span class="keyword">new</span> ColorPoint(<span class="number">1</span>, <span class="number">2</span>, Color.BLUE);</div><div class="line"></div><div class="line">p0.equals(p1); <span class="comment">// true</span></div><div class="line">p1.equals(p2); <span class="comment">// true</span></div><div class="line">p0.equals(p2); <span class="comment">// false</span></div></pre></td></tr></table></figure>
<blockquote>
<p>사실 이것은 객체 지향 언어에서 동치 관계<sub>equivalence relation</sub>를 구현할 때 발생하는 본질적 문제다. 객체 지향적 추상화<sub>object-oriented abstraction</sub>의 혜택을 누리지 않을 거라면 모를까, <strong>객체 생성 가능 클래스를 계승하여 새로운 값 컴포넌트를 추가하면서 equals 규약을 어기지 않을 방법은 없다.</strong></p>
</blockquote>
<p>  TO-DO: 리스코프 대체 원칙 위반(p52)</p>
<p>  ∴ Composition 으로 구현(<a href="#item16">규칙 16</a>).</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ColorPoint</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Point point;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Color color;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ColorPoint</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, Color color)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(color == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</div><div class="line">    point = <span class="keyword">new</span> Point(x, y);</div><div class="line">    <span class="keyword">this</span>.color = color;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> Point <span class="title">asPoint</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> point; &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(!(obj <span class="keyword">instanceof</span> ColorPoint)) <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    ColorPoint cp = (ColorPoint) obj;</div><div class="line">    <span class="keyword">return</span> cp.point.equals(point) &amp;&amp; cp.color.equals(color);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
  <figure class="highlight java"><table><tr><td class="code"><pre><div class="line">Point p0 = <span class="keyword">new</span> ColorPoint(<span class="number">1</span>, <span class="number">2</span>, Color.RED).asPoint();</div><div class="line">Point p1 = <span class="keyword">new</span> Point(<span class="number">1</span>, <span class="number">2</span>);</div><div class="line">Point p2 = <span class="keyword">new</span> ColorPoint(<span class="number">1</span>, <span class="number">2</span>, Color.BLUE).asPoint();</div><div class="line"></div><div class="line">p0.equals(p1); <span class="comment">// true</span></div><div class="line">p1.equals(p0); <span class="comment">// true</span></div><div class="line"></div><div class="line">p0.equals(p1); <span class="comment">// true</span></div><div class="line">p1.equals(p2); <span class="comment">// true</span></div><div class="line">p0.equals(p2); <span class="comment">// true</span></div></pre></td></tr></table></figure>
<p>  cf. lombok</p>
<ul>
<li><code>@Value</code> 적용한 클래스는 <code>final class</code>가 되므로 상속 불가.</li>
<li><p>롬북 활용할 경우</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="meta">@EqualsAndHashCode</span></div><div class="line"><span class="meta">@AllArgsConstructor</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> x, y;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@EqualsAndHashCode</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ColorPoint</span> <span class="keyword">extends</span> <span class="title">Point</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Color color;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ColorPoint</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, Color color)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>(x, y);</div><div class="line">    <span class="keyword">this</span>.color = color;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">Point p0 = <span class="keyword">new</span> ColorPoint(<span class="number">1</span>, <span class="number">2</span>, Color.RED);</div><div class="line">Point p1 = <span class="keyword">new</span> Point(<span class="number">1</span>, <span class="number">2</span>);</div><div class="line">Point p2 = <span class="keyword">new</span> ColorPoint(<span class="number">1</span>, <span class="number">2</span>, Color.BLUE);</div><div class="line"></div><div class="line">p0.equals(p1); <span class="comment">// false</span></div><div class="line">p1.equals(p0); <span class="comment">// false</span></div><div class="line"></div><div class="line">p0.equals(p1); <span class="comment">// false</span></div><div class="line">p1.equals(p2); <span class="comment">// false</span></div><div class="line">p0.equals(p2); <span class="comment">// false</span></div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>일관성<sub>Consistency</sub></strong>: 값의 변화가 없다면 <code>x.equals(y)</code>는 호출 횟수에 상관없이 항상 같아야 함</p>
<ul>
<li>클래스를 구현할 때는 Mutable or immutable 을 깊이 생각해본다(<a href="#item15">규칙 15</a>).</li>
<li>신뢰성이 보장되지 않는 자원<sub>unreliable resource</sub>들을 비교하는 equals를 구현하는 것은 삼가라. 그렇지 않으면 일관성 규약을 만족시키기가 너무 어려움.</li>
</ul>
</li>
<li><p><strong>Null에 대한 비 동치성<sub>Non-nullity</sub></strong>: <em>null</em>이 아닌 참조 x에 대해서 <code>x.equals(null)</code>은 항상 <code>false</code></p>
<p>  equals의 일반 규약에서는 예외가 발생하는 것을 허용하지 않는다(e.g. NPE). 그래서 상당수의 클래스는 equals() 안에서 null 조건을 명시적으로 검사하는데(e.g. <code>if (o == null) return false;</code>), 이런 검사는 불필요하다.</p>
<p>  왜냐하면, equals 메서드는 먼저 인자를 형변환<sub>cast</sub>하는데, <em>instanceof</em> 연산자는 첫 번째 피연산자가 null이면 무조건 false를 반환한다[<a href="https://docs.oracle.com/javase/specs/jls/se7/html/jls-15.html#jls-15.20.2" rel="external nofollow noopener noreferrer" target="_blank">JLS, 15.20.2</a>].</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object e)</span> </span>&#123;</div><div class="line">  <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> CustomType)) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">  &#125;</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h6 id="equlas-메서드를-구현하기-위해-따라야-할-지침"><a href="#equlas-메서드를-구현하기-위해-따라야-할-지침" class="headerlink" title="equlas 메서드를 구현하기 위해 따라야 할 지침"></a>equlas 메서드를 구현하기 위해 따라야 할 지침</h6><ol>
<li>== 연산자를 사용하여 equals의 인자가 자기 자신인지 검사 -&gt; 단순히 성능 최적화<sub>performance optimization</sub></li>
<li>instanceof 연산자를 사용하여 인자의 자료형이 정확한지 검사</li>
<li>equals의 인자를 정확한 자료형으로 변환</li>
<li>각각의 필드가 일치하는지 검사</li>
<li>equals 메서드 구현을 끝냈다면, 대칭성·추이성·일관성의 세 속성이 만족하는지 검토 -&gt; unit test</li>
</ol>
<p>(+) 추가 주의 사항</p>
<ul>
<li>equals를 구현할 떄는 hashCode도 재정의하라</li>
<li>너무 머리 쓰지 마라</li>
<li>equals 메서드의 인자 형을 Object에서 다른 것으로 바꾸지 마라</li>
</ul>
<hr>
<h2 id="규칙-9-equals-메서드를-재정의하는-클래스는-반드시-hashcode-메서드도-재정의-해야-한다"><a href="#규칙-9-equals-메서드를-재정의하는-클래스는-반드시-hashCode-메서드도-재정의-해야-한다" class="headerlink" title="규칙 9. equals 메서드를 재정의하는 클래스는 반드시 hashCode 메서드도 재정의 해야 한다"></a>규칙 9. equals 메서드를 재정의하는 클래스는 반드시 hashCode 메서드도 재정의 해야 한다</h2><blockquote>
<p>Object 일반 규약[JavaSE6]</p>
<ul>
<li>응용프로그램 실행 중에 같은 객체의 hashCode를 여러 번 호출하는 경우, equals가 사용하는 정보들이 변경되지 않았다면, 언제나 동일한 정수가 반환되어야 한다. 다만 프로그램이 종료되었다가 다시 실행되어도 같은 값이 나올 필요는 없다.</li>
<li>equals(Object) 메서드가 같다고 판정한 두 객체의 hashCode 값은 같아야 한다.</li>
<li>equals(Object) 메서드가 다르다고 판정한 두 객체의 hashCode 값은 꼭 다를 필요는 없다.그러나 서로 다른 hashCode 값이 나오면 hash table의 성능이 향상될 수 있다는 점은 이해하고 있어야 한다.</li>
</ul>
</blockquote>
<ul>
<li><strong>equals 메서드를 재정의하는 클래스는 반드시 hashCode 메서드도 재정의 해야 한다.</strong> override 하지 않으면 Object 일반 규약중 두번째, 같은 객체는 같은 해시 코드 값을 가져야 한다는 규약이 위반되는 것이다. 재정의하지 않으면 Hash 기반 컬렉션과 함께 사용하면 오동작한다(e.g. HashMap, HashSet, …)</li>
<li>좋은 해시 함수는 다른 객체에서 다른 해시 코드를 반환하는 경향이 있다. - 충돌<sub>Collision</sub> 회피<ul>
<li>이상적인 해시 함수 만드는 방법 책 참고 - p64</li>
<li><a href="https://projectlombok.org/features/EqualsAndHashCode.html" rel="external nofollow noopener noreferrer" target="_blank">lombok</a>의 <code>@EqualsAndHashCode</code> 참고(책의 방법과 비슷)</li>
</ul>
</li>
<li>해시 코드 계산 비용이 높은 변경 불가능 클래스를 만들 때는, 재계산하는 대신 캐시해 두어야 할 수도 있다. 또한 경우에 해시 키에 따라 lazy initialization도 가능하다.</li>
<li><strong>주의할 것은, 성능을 개선하려고 객체의 중요 부분을 해시 코드 계산 과정에서 생략하면 안된다.</strong></li>
</ul>
<h4 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h4><ul>
<li><a href="http://d2.naver.com/helloworld/831311" rel="external nofollow noopener noreferrer" target="_blank">Java HashMap은 어떻게 동작하는가?</a></li>
</ul>
<hr>
<h2 id="규칙-10-tostring은-항상-재정의하라"><a href="#규칙-10-toString은-항상-재정의하라" class="headerlink" title="규칙 10. toString은 항상 재정의하라"></a>규칙 10. toString은 항상 재정의하라</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">// 이것보단</div><div class="line">PhoneNumber@163b91</div><div class="line">// 이게 훨씬 낫다!</div><div class="line">(070) 867-5309</div></pre></td></tr></table></figure>
<blockquote>
<p>“모든 하위 클래스는 이 메서드를 재정의함이 바람직하다.” - toString 일반 규약</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PhoneNumber</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> Agency agency; <span class="comment">// 통신사</span></div><div class="line">  <span class="keyword">private</span> String number; <span class="comment">// 전화번호</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> Agency <span class="title">getAgency</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> agency; &#125; ④</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * 전화번호를 문자열로 변환해서 반환한다.</div><div class="line">   * "[SKT] 010-1234-1234" 형식으로 반환된다. ③</div><div class="line">   * ....</div><div class="line">   */</div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; ①</div><div class="line">    <span class="keyword">return</span> agency.getName() + <span class="string">" "</span> + number; ②</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>toString을 잘 만들어 놓으면 클래스를 좀 더 쾌적하게 사용할 수 있다.</li>
<li>가능하다면 toString()는 객체 내의 중요 정보를 전부 담아 반환해야 한다.</li>
<li>toString이 반환하는 문자열의 형식을 명시하건 그렇지 않건 간에, 어떤 의도인지는 문서에 분명하게 남겨야 한다.</li>
<li>toString이 반환하는 문자열에 포함되는 정보들은 전부 프로그래밍을 통해서 가져올 수 있도록(programmatic access)하라.<br> toString에 포함되는 정보를 가져올 수 있는 accessor를 만들지 않으면, 클라이언트는 toString을 파싱하려 할 것이다.</li>
</ol>
</div></article></div><div class="addthis_inline_share_toolbox"></div><div class="ad"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins style="display:block" data-ad-client="ca-pub-2402079508512433" data-ad-slot="9218385844" data-ad-format="auto" class="adsbygoogle"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></main><footer><div class="paginator"><a href="/2017/03/22/methods-common-to-all-objects-2/" class="prev">PREV</a><a href="/2017/02/21/creating-and-destroying-objects-3/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'wicksome';
var disqus_identifier = '2017/03/11/methods-common-to-all-objects-1/';
var disqus_title = '이펙티브자바 3장. 모든 객체의 공통 메서드 - 1';
var disqus_url = 'https://wickso.me/2017/03/11/methods-common-to-all-objects-1/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//wicksome.disqus.com/count.js" async></script><div class="copyright"><p>© 2017 <a href="https://wickso.me">Yeongjun Kim</a>, powered by <a href="https://hexo.io/" target="_blank" rel="external nofollow noopener noreferrer">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank" rel="external nofollow noopener noreferrer">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-58fee1a404df6aa5"></script><!-- - font awesome--><script src="https://use.fontawesome.com/25a562aa7c.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-43444044-3",'auto');ga('send','pageview');</script></body></html>